<html>
<title>Skybill software for traffic statistics processing</title>
<h1 align='center'>Skybill, your traffic counting</h1>
<p>Here comes the set of perl programs, most of them are plain Perl scripts to take information about traffic and put them into the database appropriately. The rest is a CGI program to show the results to the user.</p>
<p>The CGI output is show on the <a href='http://skybill.vereshagin.org'>Skybill demo</a> page. That site is very &laquo;social&raquo; because the Skybill analyses the web server&amp;s access log there: it counts every visitor and shows his/her/its IP address to everyone, so in respect of your privacy I warn you about that before you click. There&amp;s a latency on traffic analisys so you should wait some minutes before you notice your IP address on that page as you may expect as a result.</p>
<p>Hardware requirements of the Skybill are very low: it passed several GB of traffic per day running via Pentium1 machine for years. Needless to say, the application tasks like web caching proxy and e-mail daemons did the load there among with Skybill, too.
<h2 align='center'>The purpose</h2>
<p>Originally, the software was intended for counting the traffic which was very expensive ( $0.1 per 1 MByte of data, no matter in or out ) because George Soross had underdeveloped the Internet in Russia (joke). It was a small LAN of an enterprise that was unsatisfied with every existing software to the date. This way, it was about to control the ISP statistics and local users' Internet consumption and was released as a v0.1</p>
<p>Some unexpected usage of the Skybill was found when the email viruses came on the scenes. Those were the times when we had news on the feeds like this one: &laquo;Spammers&amp; software got skills to send itself via the particular deployment&amp;s ISP&amp;s relay&raquo;. It was obvious to look at the who is the most active sender on the port 25/tcp ( smtp ) to know what exactly workstation should be cured.</p>
<p>Clocks changed and things too, but people not.</p>
<p>Traffic was unchained for everyone with bandwidth limited only, so here we go about to know for every particular Internet user and server to know about the Internet connection&amp;s use by the case. Isn&amp;t it a next voluntary botnet like the Skype that use your paid full bandwidth without any excuse? How far it comes about your dedicated server&amp;s traffic? All of those things still cost money and here is how you can be more smart about those exepnses. Not to mention the additional care about your system&amp;s health.</p>
<p>To adopt for the conditions, changes were made about always changing IP address (thanks to my ISP) on behalf of your ISP and the ports being listened ( thanks to Skype, again ). But it is not mandatory part of the software as it is the part of the configuratino file which is written in Perl.</p>
<h2 align='center'>What This Isn&amp;t</h2>
<p>You may want to look for the software to get the primary information about the traffic that passes through you hardware, like the network interfaces and routers, and software, like packet filters and application proxies.</p>
<p>Although you definitely must have one to get Skybill up and running, this is not the exact place to get them as it depends on you proprietary need. As an example you may want to use some scripts like ipacct2mysql from this package as ipacctd software is the one of them, but that program is too obvious to be considered as of any interest. To have a clue, you may ixquick or google for: ulogd if you need Linux&amp; packet filter as the traffic information source, or ipacctd/ng_ipacct to take the same advantage for FreeBSD; it&amp;s just obvious thing to plug Skybill into any imagineable stuff in the world like the squid2mysql daemon, Cisco&amp;s netflow or Agnitum Outpost logs. Of course, any third-party scripts share for Skybill is appreciated.</p>
<h2 align='center'>How this works</h2>
<p>Before we dig into details, the key to understand this is: the Client nature of the traffic and the Server-generated nature of the bytes to count.</p>
<p>Client means the connection is established by ours. This means we need no information about our number of a port, only of remote. And vice-versa about Server-generated traffic: we need not no know about remote port's number, but the our port number is of a definite interest.</p>
<div align='center'><img border='0'
	src='./img/skybill03.png'
/><br
/>Figure 1. Traffic processing by the cron scripts</div>
<p>
<p>The program knows about the reason to separate from the config, the lib/Skybill/Config.pm . The packaged default is all about to take this information from the system&amp;s ifconfig/ipconfig and netstat commands when needed. You may want to keep those data manually enetered and persistent on a server.</p>
<p>On the left of the scheme, the traffic information source puts the data into the &amp;raw&amp; table. The time granularity for those data is once per second, and there should be no any duplicates on src:port and dest:port. To increase the performance, the data is stored as 4-byte sequences (numbers), as all of the IPv4 addresses are them, initially.</p>
<p>In the case if you have several statistics sources like ipacct and squid it is convinient to observe the primary key violation exception throw into the mail from cron because that means not every appropriate packet is transparently proxified by squid. In the case it is not the wanted behavior you may want to disable the key constraint on the &amp;raw&amp; table in favor of index instead.</p>
<p>It is highly necessary that data to be processed sequentially from raw to clients and servers data before the next such a process is launched again so it is where you must find a balance between data collection speed and data integrity. I find it useful to launch cliserv script every few minutes, but YMMV.</p>
<p>It worths to note that besides unmentioning about the unneeded port number on the clients and servers data, the timestamp field shows the last time when the particular client was using the particular server. So it may be useful as a source for the various daytime charts about particular clients and servers utilization.</p>
<p>After the clients and servers tables are fullfilled, the data are aggregated into the details_daily table with no sense about ports numbers, i. e. about relationship between the particular hosts. This was useful for LAN routing/NAT service users monitoring but still helps for one host only.</p>

</html>
